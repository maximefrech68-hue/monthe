<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comptabilit√© - MonTh√©</title>
    <link rel="stylesheet" href="style.css" />
    <style>
      .login-screen {
        max-width: 400px;
        margin: 4rem auto;
        padding: 2rem;
        background: white;
        border-radius: 14px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }

      .login-form {
        display: grid;
        gap: 1rem;
      }

      .login-form input {
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #d9d2c7;
        font-size: 16px;
      }

      .error-msg {
        background: #fee;
        color: #c00;
        padding: 10px;
        border-radius: 8px;
        margin-bottom: 1rem;
        display: none;
      }

      .accounting-table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        margin-top: 1rem;
      }

      .accounting-table th {
        background: #a0826d;
        color: white;
        padding: 12px 8px;
        text-align: left;
        font-weight: 600;
        font-size: 13px;
      }

      .accounting-table td {
        padding: 10px 8px;
        border-bottom: 1px solid #e0e0e0;
        font-size: 14px;
      }

      .accounting-table tr:hover {
        background: #f7f4ef;
      }

      .accounting-table th:nth-child(5),
      .accounting-table th:nth-child(6),
      .accounting-table th:nth-child(7),
      .accounting-table th:nth-child(8),
      .accounting-table th:nth-child(11),
      .accounting-table th:nth-child(12),
      .accounting-table td:nth-child(5),
      .accounting-table td:nth-child(6),
      .accounting-table td:nth-child(7),
      .accounting-table td:nth-child(8),
      .accounting-table td:nth-child(11),
      .accounting-table td:nth-child(12) {
        text-align: right;
      }

      .btn-edit,
      .btn-delete {
        padding: 6px 12px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 13px;
        margin-right: 4px;
      }

      .btn-edit {
        background: #a0826d;
        color: white;
      }

      .btn-edit:hover {
        background: #8d7160;
      }

      .btn-delete {
        background: #b00020;
        color: white;
      }

      .btn-delete:hover {
        background: #900018;
      }

      .download-link {
        color: #a0826d;
        text-decoration: none;
        font-weight: 600;
      }

      .download-link:hover {
        text-decoration: underline;
      }

      .modal {
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
      }

      .modal-content {
        background: white;
        margin: 5% auto;
        padding: 20px;
        border-radius: 14px;
        width: 90%;
        max-width: 500px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .close {
        float: right;
        font-size: 28px;
        font-weight: bold;
        cursor: pointer;
        color: #666;
      }

      .close:hover {
        color: #000;
      }

      .form-group {
        margin-bottom: 1rem;
      }

      .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: #2b2b2b;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #d9d2c7;
        font-size: 14px;
      }

      .export-btn,
      .reset-btn {
        background: #4a7c59;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 600;
        margin-right: 8px;
      }

      .export-btn:hover,
      .reset-btn:hover {
        background: #3d6a4a;
      }

      .reset-btn {
        background: #666;
      }

      .reset-btn:hover {
        background: #555;
      }

      @media (max-width: 768px) {
        .accounting-table {
          font-size: 12px;
        }

        .accounting-table th,
        .accounting-table td {
          padding: 8px 4px;
        }

        .btn-edit,
        .btn-delete {
          padding: 4px 8px;
          font-size: 12px;
        }
      }
    </style>
  </head>
  <body>
    <!-- √âcran de connexion -->
    <div id="loginScreen" class="login-screen">
      <h2>Comptabilit√© - MonTh√©</h2>
      <div id="loginError" class="error-msg"></div>
      <form id="loginForm" class="login-form">
        <input
          type="password"
          id="password"
          placeholder="Mot de passe"
          required
          autocomplete="current-password"
        />
        <button type="submit" class="primary-btn">Se connecter</button>
      </form>
    </div>

    <!-- Interface comptabilit√© (cach√©e par d√©faut) -->
    <div id="accountingPanel" class="hidden">
      <div class="topbar">
        <a href="admin.html" class="btn-back">‚Üê Retour Admin</a>
        <button id="logoutBtn" class="logout-btn">D√©connexion</button>
      </div>

      <header>
        <h1>MonTh√© - Comptabilit√©</h1>
        <p>Livre des recettes (VENTES)</p>
        <p id="ventesCount" style="font-size: 14px; color: #ff8c00; margin-top: 0.5rem;">
          <strong id="ventesCountNumber">0</strong> entr√©e(s)
        </p>
      </header>

      <main>
        <!-- Toolbar filtres -->
        <section class="toolbar">
          <input
            id="search"
            type="text"
            placeholder="Rechercher par N¬∞ commande, client, produit..."
          />

          <select id="dateFilter">
            <option value="">Toutes les dates</option>
            <option value="today">Aujourd'hui</option>
            <option value="week">Cette semaine</option>
            <option value="month">Ce mois</option>
          </select>

          <select id="clientFilter">
            <option value="">Tous les clients</option>
          </select>

          <select id="productFilter">
            <option value="">Tous les produits</option>
          </select>

          <select id="amountFilter">
            <option value="">Tous les montants</option>
            <option value="0-50">0-50‚Ç¨</option>
            <option value="50-100">50-100‚Ç¨</option>
            <option value="100-200">100-200‚Ç¨</option>
            <option value="200+">200‚Ç¨+</option>
          </select>

          <button id="resetFiltersBtn" class="reset-btn">üîÑ R√©initialiser</button>
          <button id="syncBtn" class="export-btn" style="background: #ff8c00;" title="Recalcule les valeurs manquantes (HT, TVA, frais, net)">üîß Synchroniser</button>
          <button id="exportBtn" class="export-btn">üì• Exporter CSV</button>
        </section>

        <!-- Section 4: Table comptabilit√© avec 14 colonnes -->
        <section class="accounting-container" style="padding: 2rem; overflow-x: auto;">
          <table id="accountingTable" class="accounting-table">
            <thead>
              <tr>
                <th style="width: 40px;">
                  <input type="checkbox" id="selectAllCheckbox" title="Tout s√©lectionner" />
                </th>
                <th style="min-width: 140px;">Date Paiement</th>
                <th style="min-width: 120px;">N¬∞ Commande</th>
                <th style="min-width: 150px;">Client</th>
                <th style="min-width: 200px;">Produits</th>
                <th style="min-width: 90px;">Montant HT</th>
                <th style="min-width: 80px;">TVA</th>
                <th style="min-width: 100px;">Montant TTC</th>
                <th style="min-width: 100px;">Moyen</th>
                <th style="min-width: 100px;">Plateforme</th>
                <th style="min-width: 90px;">Frais</th>
                <th style="min-width: 100px;">Net Encaiss√©</th>
                <th style="min-width: 100px;">Facture</th>
                <th style="min-width: 150px;">Actions</th>
              </tr>
            </thead>
            <tbody id="accountingBody">
              <!-- Lignes inject√©es dynamiquement par accounting.js -->
            </tbody>
          </table>
        </section>
      </main>
    </div>

    <!-- Section 5: Modal d'√©dition des entr√©es comptables -->
    <div id="editModal" class="modal hidden">
      <div class="modal-content">
        <span class="close" id="closeModal">&times;</span>
        <h2>Modifier l'entr√©e comptable</h2>

        <form id="editForm">
          <input type="hidden" id="editOrderId" />

          <div class="form-group">
            <label for="editMontantTTC">Montant TTC (‚Ç¨) *</label>
            <input
              type="number"
              id="editMontantTTC"
              step="0.01"
              min="0"
              placeholder="0.00"
              required
            />
            <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
              Prix de vente TTC (TVA incluse)
            </small>
          </div>

          <div class="form-group">
            <label for="editTauxTVA">Taux TVA (%) *</label>
            <input
              type="number"
              id="editTauxTVA"
              step="0.1"
              min="0"
              max="100"
              placeholder="20"
              required
            />
            <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
              Taux de TVA applicable (d√©faut: 20%)
            </small>
          </div>

          <div class="form-group">
            <label for="editFraisPaiement">Frais de paiement (‚Ç¨) *</label>
            <input
              type="number"
              id="editFraisPaiement"
              step="0.01"
              min="0"
              placeholder="0.00"
              required
            />
            <small style="color: #666; font-size: 12px; margin-top: 4px; display: block;">
              Frais de plateforme (Netlify/Stripe)
            </small>
          </div>

          <div style="background: #f0f8ff; padding: 12px; border-radius: 8px; margin-top: 1rem; font-size: 13px;">
            <strong>Calculs automatiques:</strong><br>
            ‚Ä¢ Montant HT = TTC √∑ (1 + taux TVA)<br>
            ‚Ä¢ TVA = TTC - HT<br>
            ‚Ä¢ Net encaiss√© = HT - frais = TTC - TVA - frais
          </div>

          <div style="display: flex; gap: 10px; margin-top: 1.5rem;">
            <button type="submit" class="primary-btn" style="flex: 1;">
              ‚úì Enregistrer
            </button>
            <button type="button" id="cancelEdit" class="reset-btn" style="flex: 1;">
              ‚úï Annuler
            </button>
          </div>
        </form>
      </div>
    </div>

    <script src="accounting.js"></script>
  </body>
</html>
